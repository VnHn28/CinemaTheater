<style type="text/css">
	body{
		margin: 0 auto;
		background-color: #f4f4de ;
	}

	#left{
		padding-left: 10px;
		padding-top: 10px;
	}

	#schedule{
		width: 360px;
		background-color: #d6d6d6;
		margin-top: 20px;
		padding-top: 10px;
		padding-left: 5px;
		padding-bottom: 10px;
		height: auto;
	}

	#labelSch{
		font: 28;
		font-weight: bolder;
	}

	.movieSchedule{
		padding-left: 5px;
		background-color: #99ccff;
		width: 350px;
		height: 30px;
		vertical-align: middle;
		margin-bottom: 2px;
	}

	#borderLine{
		width: 3px;
		height: 814px;
		background-color: black;
		position: absolute;
		left: 385px;
		top: 0px;
	}

	.availableSeat{
		width: 40px;
		height: 40px;
		margin-left: 3px;
		margin-top: 3px;
		float: left;
		background-color: grey;
		text-align: center;
		vertical-align: middle;
	}

	#seating{
		top: 10px;
		left: 400px;
		width: 870px;
		height: 740px;
		position: absolute;
	}

	.stair{
		width: 40px;
		height: 40px;
		margin-left: 3px;
		margin-top: 3px;
		float: left;
	}
	.bookedSeat{
		width: 40px;
		height: 40px;
		margin-left: 3px;
		margin-top: 3px;
		float: left;
		background-color: #00802b;
		text-align: center;
		vertical-align: middle;
	}

	#bottom{
		top: 96%;
		position: absolute;
	}
</style>

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Cinema 21 Seat Booking</title>
</head>
<body>
	<div id="left">
		<div id="inputMovie">
			<h2>Input movie</h2>
			<label class="labelTxt" for="movie">Movie :</label>
			<input type="text" id="txtTitle"><br><br>
			<label class="labelTxt" for="studio">Studio :</label>
			<select id="cmbStudio">
			   	<option value="1">1</option>
			   	<option value="2">2</option>
			   	<option value="3">3</option>
			   	<option value="4">4</option>
			   	<option value="5">5</option>
			</select><br><br>
			<label class="labelTxt" for="time">Time :</label>
			<select id="cmbTime">
			   	<option value="morning">08.00-10.15</option>
			   	<option value="noon">10.45-13.00</option>
			   	<option value="afternoon">13.30-15.45</option>
			   	<option value="evening">16.15-18.30</option>
			   	<option value="night">19.00-21.15</option>
			</select><br><br>
			<button id="btnAddMovie" style="background-color: lightgray;">Add Movie</button>
		</div>
		<div id="schedule">
			<label id="labelSch" for="schedule">Schedule - </label>
			<select id="cmbSchedule">
			   	<option value="1">1</option>
			   	<option value="2">2</option>
			   	<option value="3">3</option>
			   	<option value="4">4</option>
			   	<option value="5">5</option>
			</select><br><br>
			<div id="timeTable"></div>
		</div>
		<div id="booking">
			<h2>Booking</h2>
			<label class="labelTxt" for="seats">Num of Seats :</label>
			<input type="number" id="numSeats" min="1">
			<button id="btnSelect" style="background-color: lightgray;">Select Seats</button>
		</div>
	</div>
	<div id="borderLine"></div>
	<div id="seating">
		<div id="seats"></div>
		<div id="bottom">
			<div id="seatLeft"></div>
			<button id="btnBook" style="background-color: lightgray;">Book Seats</button>
		</div>
	</div>
	
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.js">
</script>

<script type="text/javascript">
	$(document).ready(function(){
		var arrMovie = [];
		var movie;
		var objSeat;
		var arrMovieSeating = [];
		var seatingIndex=0;
		var whichmovieSeats;
		var seatSelection;
		var numofseatstoSelect;

		//if(seatSelection<=0){
			$("#bottom").hide();
		//}

		$("#btnAddMovie").click(function(){
			movie = new Object();
			movie.title=$("#txtTitle").val();
			movie.time=$("#cmbTime option:selected").text();
			movie.studio=$("#cmbStudio option:selected").val();
			movie.index=seatingIndex;

			arrMovie.push(movie);
			seatingIndex++;

			generateSeats();

			displaySchedule();
		})

		function generateSeats(){
			var arrRow=[];
			//$("#seats").innerHTML=t;
			for (var i = 0; i < 15; i++) {
				var arrCollumn = [];
				row=String.fromCharCode(i+65);
				for (var j = 0; j < 18; j++) {
					//console.log(row+j)
					objSeat = new Object();
					if(j<10){
						objSeat.id = row+'0'+j;
					} else{
						objSeat.id = row+j;
					}
					objSeat.status = "non";
					objSeat.row = i; //why not use 'row' directly and not 'i'
					objSeat.col = j;
					arrCollumn.push(objSeat);
				}
				arrRow.push(arrCollumn);
			}
			arrMovieSeating.push(arrRow);
		}

		$("#cmbSchedule").change(function(){
			displaySchedule();
		})

		function displaySchedule(){
			var thisStudio = $("#cmbSchedule option:selected").val();
			//alert(thisStudio)
			$("#timeTable").empty();
			for (var i = 0; i < arrMovie.length; i++) {
				let thisMovie = arrMovie[i];
				if(thisMovie.studio==thisStudio){
					//alert("in");
					var newSchedule=document.createElement("div");
					newSchedule.innerHTML = thisMovie.time+' _ '+thisMovie.title;
					newSchedule.value = thisMovie.index;
					newSchedule.className = 'movieSchedule';
					let loc = $("#timeTable");
					loc.append(newSchedule);
				}
			}
		}

		$("body").on("click", ".movieSchedule", function(){
			whichmovieSeats = $(this).val();
			//alert(whichmovieSeats);
			displaySeats();
		})

		function displaySeats(){
			//alert(arrMovieSeating.length);
			var stairs = 0;
			var splicechairArr = 0
			let thisMovie = whichmovieSeats;
			//alert(thisMovie);
			let movieSeating = arrMovieSeating[thisMovie];
			$("#seats").empty();
			for (var i = 0; i < 15; i++) {
				for (var j = 0; j < 20; j++) {
					var seat = document.createElement("div");
					if (j==4||j==15) {
						stairs+=1;
						seat.className = "stair";
					} else {
						seat.innerHTML = movieSeating[i][j-stairs].id;
						seat.value = movieSeating[i][j-stairs].status;
						//console.log(seat.value);
						seat.row = movieSeating[i][j-stairs].row;
						//console.log(seat.row);
						seat.col = movieSeating[i][j-stairs].col;
						//console.log(seat.col);
						seat.mov = whichmovieSeats;
						//console.log(seat.mov);
						seat.arr = splicechairArr;

						if(seat.value=="non"){
							seat.className = "availableSeat";
						} else if(seat.value=="booked"){
							seat.className="bookedSeat";
						}
						splicechairArr++;
					}

					let loc = $("#seats");
					loc.append(seat);
				}
				stairs=0;
			}
		}

		$("#btnSelect").click(function(){
			seatSelection=$("#numSeats").val();
			numofseatstoSelect=seatSelection;

			$("#bottom").show();
			$("#seatLeft").html("Seats to pick: "+seatSelection);
			mTix();

		})

		function mTix(){
			let thisMovie;
			let arrSelectedseat = [];

			if(seatSelection>-1){
				$("body").on("mouseenter", ".availableSeat", function(){
	   	 	  		$(this).fadeTo("fast",0.8);
				});
				$("body").on("mouseleave", ".availableSeat", function(){
	   	 		   	$(this).fadeTo("fast", 1);
				});

				if(seatSelection>0){
					$("body").on("click", ".availableSeat", function(){
						thisMovie = $(this).prop('mov');

						if($(this).prop('value')=='non'){
							$(this).css({"background-color":'#fec700'});
							$(this).prop('value')='picked';
							
							objTicket = new Object();
							objTicket.index = $(this).prop('arr');
							objTicket.row = $(this).prop('row');;
							objTicket.col = $(this).prop('col');
							arrSelectedseat.push(objTicket);

							alert(arrSelectedseat.length);
							seatSelection++;
						} else if($(this).prop('value')=="picked"){
							for (var i = 0; i < arrSelectedseat.length; i++) {
								if(arrSelectedseat[i].index==$(this).prop('arr')){
									arrSelectedseat.splice(i,1);
								}
							}
							$(this).css({"background-color":'grey'});
							$(this).prop('value')='non';
							seatSelection--;
						}
						//alert($(this).val());
						
					});
				} else if(seatSelection==0){
					$("body").on("click", ".availableSeat", function(){
						alert("Currently already "+numofseatstoSelect+" seat(s) are selected!")
					});
				} 

				$("#btnBook").click(function(){
					for (var i = 0; i < arrSelectedseat.length; i++) {
						let thisRow = arrSelectedseat[i].row;
						//alert(thisRow);
						let thisCol = arrSelectedseat[i].col;
						//alert(thisCol);
						let movieSeating = arrMovieSeating[thisMovie];
	
						movieSeating[thisRow][thisCol].status = "booked";
					}
					seatSelection--;
					$("#bottom").hide();
					displaySeats();
				});

				$("body").on("click", ".bookedSeat", function(){
	   	 		   	alert("This seat is already booked!");
				});
			} 
		}

	})
</script>